"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5508],{5508:(E,u,i)=>{i.r(u),i.d(u,{LoginPage:()=>T});var p=i(467),n=i(3953),C=i(177),r=i(4341),F=i(1868),f=i(8573),g=i(2700),P=i(5079),m=i(5873),x=i(4796),M=i(3236),O=i(9974),y=i(4360),w=i(1730);function k(e,l){if(1&e&&n.nrm(0,"ion-progress-bar",3),2&e){const s=n.XpG();n.Y8G("value",s.progress)}}function L(e,l){1&e&&(n.j41(0,"div",12)(1,"label",18),n.EFF(2," Addresse email non valide"),n.k0s()())}function I(e,l){1&e&&(n.j41(0,"div",12)(1,"label",18),n.EFF(2," Mot de pass non valid et doit avoir une longeur de 8 charactere et dois contenir au moin un charactere special ou un emajuscule"),n.k0s()())}function S(e,l){if(1&e){const s=n.RV6();n.j41(0,"form",5),n.bIt("ngSubmit",function(){n.eBV(s);const o=n.XpG();return n.Njj(o.onSubmit())}),n.j41(1,"div",6)(2,"div",7),n.nrm(3,"input",8)(4,"ion-icon",9),n.k0s(),n.j41(5,"div",7),n.nrm(6,"input",10)(7,"ion-icon",11),n.k0s(),n.DNE(8,L,3,0,"div",12)(9,I,3,0,"div",12),n.j41(10,"ion-button",13),n.EFF(11,"login"),n.k0s(),n.j41(12,"div",14)(13,"a",15),n.EFF(14,"forgot password? "),n.k0s()()(),n.j41(15,"div",16)(16,"p"),n.EFF(17," New member?"),n.j41(18,"a",17),n.EFF(19,"sign-up now"),n.k0s()()()()}if(2&e){const s=n.XpG();n.Y8G("formGroup",s.loginForm),n.R7$(3),n.Y8G("formControl",s.loginForm.controls.email),n.R7$(5),n.vxM(s.emailIsInvalid?8:-1),n.R7$(),n.vxM(s.passwordIsInvalid?9:-1)}}let T=(()=>{var e;class l{constructor(){this.destroyRef=(0,n.WQX)(n.abz),this.authService=(0,n.WQX)(x.u),this.signalementsService=(0,n.WQX)(w.W),this.progress=0,this.formSubmitted=!1,this.isFetching=(0,n.vPA)(!1),this.toastController=(0,n.WQX)(g.K_),this.router=(0,n.WQX)(f.Ix),this.loginForm=new r.gE({email:new r.MJ("",{validators:[r.k0.email,r.k0.required]}),password:new r.MJ("",{validators:[r.k0.required,r.k0.minLength(8),F.$]})}),(0,P.a)({personOutline:m.wAZ,lockClosedOutline:m.eso,chevronForward:m.fZ}),setInterval(()=>{this.progress+=.01,this.progress>1&&setTimeout(()=>{this.progress=0},1e3)},50)}ngOnInit(){const t=window.localStorage.getItem("saved-login-form");if(t){const a=JSON.parse(t);this.loginForm.patchValue({email:a.email})}const o=this.loginForm.valueChanges.pipe(function b(e,l=M.E){return(0,O.N)((s,t)=>{let o=null,a=null,c=null;const v=()=>{if(o){o.unsubscribe(),o=null;const d=a;a=null,t.next(d)}};function j(){const d=c+e,h=l.now();if(h<d)return o=this.schedule(void 0,d-h),void t.add(o);v()}s.subscribe((0,y._)(t,d=>{a=d,c=l.now(),o||(o=l.schedule(j,e),t.add(o))},()=>{v(),t.complete()},void 0,()=>{a=o=null}))})}(500)).subscribe({next:a=>{window.localStorage.setItem("saved-login-form",JSON.stringify({email:a.email}))}});this.destroyRef.onDestroy(()=>{o.unsubscribe()})}get emailIsInvalid(){return this.loginForm.controls.email.touched&&this.loginForm.controls.email.dirty&&this.loginForm.controls.email.invalid}get passwordIsInvalid(){return this.loginForm.controls.password.touched&&this.loginForm.controls.password.dirty&&this.loginForm.controls.password.invalid}onSubmit(){var t=this;return(0,p.A)(function*(){if(t.loginForm.invalid)return void(t.formSubmitted=!0);t.isFetching.set(!0);const o=t.loginForm.value.email,a=t.loginForm.value.password;try{const c=yield t.authService.login(o,a);if(!c)throw new Error("Erreur lors de la connexion, veuillez v\xe9rifier vos identifiants.");console.log("User logged in successfully:",c),yield t.signalementsService.loadSignalements(),t.router.navigate(["/signalements/liste"])}catch(c){console.error("Login failed:",c.message),yield t.showToast("\xc9chec de la connexion. Veuillez r\xe9essayer plus tard.")}finally{t.isFetching.set(!1)}})()}showToast(t){var o=this;return(0,p.A)(function*(){(yield o.toastController.create({message:t,duration:2e3,position:"top"})).present()})()}}return(e=l).\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.VBU({type:e,selectors:[["app-login"]],standalone:!0,features:[n.aNF],decls:7,vars:1,consts:[[1,"header"],[1,"title"],[1,"subTitle"],[3,"value"],[3,"formGroup"],[3,"ngSubmit","formGroup"],["div","",1,"ion-padding"],[1,"input-container"],["placeholder","username","name","email",1,"input",3,"formControl"],["name","person-outline",1,"input-icon"],["placeholder","password","name","password","type","password","formControlName","password",1,"input"],["name","lock-closed-outline",1,"input-icon"],[1,"error-message"],["type","submit","expand","block"],[1,"forgotPassword"],["routerLink","/auth/password-reset",2,"color","#ffc33f"],[1,"signupLink"],["routerLink","/auth/signup",2,"color","#ffc33f"],[1,"show"]],template:function(t,o){1&t&&(n.j41(0,"div",0)(1,"ion-title",1),n.EFF(2,"welcome back"),n.k0s(),n.j41(3,"p",2),n.EFF(4,"sign in to access your account"),n.k0s()(),n.DNE(5,k,1,1,"ion-progress-bar",3)(6,S,20,4,"form",4)),2&t&&(n.R7$(5),n.vxM(o.isFetching()?5:6))},dependencies:[g.FH,g.Jm,g.iq,g.BC,C.MD,r.YN,r.qT,r.me,r.BC,r.cb,f.Wk,r.X1,r.l_,r.j4,r.JD],styles:['@charset "UTF-8";.input-container[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;margin-bottom:1rem}input[_ngcontent-%COMP%]{padding:10px;border:3px solid transparent;width:100%;box-sizing:border-box;padding:1.2rem;border-radius:.9rem;background-color:#f1f1f1}input[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::placeholder{text-align:left}input[_ngcontent-%COMP%]:focus{border-color:#51c2d5;outline:none}.input-icon[_ngcontent-%COMP%]{position:absolute;z-index:999;right:15px;font-size:1.5rem;top:50%;transform:translateY(-50%)}ion-item[_ngcontent-%COMP%]{--background: #f1f1f1;border-radius:10px;margin-bottom:16px}.input.ng-touched[_ngcontent-%COMP%]{border:none;transition:var(--background) .2s ease;background:#ffdede;animation:_ngcontent-%COMP%_opa .5s ease-in-out}@keyframes _ngcontent-%COMP%_opa{0%,to{transform:translate(0)}25%{transform:translate(-15px)}50%{transform:translate(15px)}75%{transform:translate(-15px)}}.header[_ngcontent-%COMP%]{margin-top:100px;margin-bottom:80px;text-align:center}.header[_ngcontent-%COMP%]   .subTitle[_ngcontent-%COMP%]{color:gray;font-size:.9rem}.header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:2rem}.signupLink[_ngcontent-%COMP%]{display:flex;margin:auto;flex-direction:row;align-content:center;position:absolute;left:0;bottom:0;width:80%;right:0}.signupLink[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}.signupLink[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;margin-left:.5rem}ion-content[_ngcontent-%COMP%]{z-index:999}.error-message[_ngcontent-%COMP%]{color:red;font-size:.9rem;margin-top:10px;text-align:center;opacity:0;animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out forwards}.error-message[_ngcontent-%COMP%]   .show[_ngcontent-%COMP%]{opacity:1;animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out forwards}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}']}),l})()}}]);